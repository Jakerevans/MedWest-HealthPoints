/**
 * JavaScript Admin Functions - medwesthealthpoints-frontend.min.js
 *
 * @author   Jake Evans
 * @category JavaScript
 * @package  Includes/Assets/Js
 * @version  6.0.0
 */

console.log( 'This is the JavaScript Object that holds all PHP Variables for use in the medwesthealthpoints Front-End JavaScript file:' );
console.log( medwestHealthpointsPhpVariables );


// All functions wrapped in jQuery(document ).ready()...
jQuery( document ).ready( function( $ ) {
	'use strict';

	/* BEGINNING SECTION TO CALL ALL FUNCTIONS IN FILE... */

	// Function to expand the Join/Register form...
	medwestExpandRegisterForm();

	// Function to register a user for HealthPoints.
	medwestJoinHealthPoints();

	// Function that makes sure e-mail addresses match.
	medwestEmailMatching();

	// For checking for, and displaying error message if, passwords don't match.
	medwestPasswordMatching();

	/* ENDING SECTION TO CALL ALL FUNCTIONS IN FILE... */


	// For checking for, and displaying error message if, emails don't match.
	function medwestEmailMatching() {

		$( document ).on( 'keyup', '.medwesthealthpoints-form-section-fields-indiv-wrapper-emailconfirmblock input', function( event ) {

			// Get the wrapper element...
			var wrapper = $(this).parent().parent();

			// Get the two E-Mail values
			var email = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-email' ).val().toLowerCase();
			var emailConfirm = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-emailconfirm' ).val().toLowerCase();
			var message = wrapper.find( '.medwesthealthpoints-confirmemail-block-message-div' );

			setTimeout( function() {
				if ( email !== emailConfirm ) {
					message.attr( 'data-activated','true' );
					message.html( 'E-Mails Don\'t Match!' );
					message.css({'color': '#DE235A', 'margin-left': '10px', 'margin-right': '10px'});
					message.animate({'opacity': '1'}, 300 );
				} else {
					message.attr( 'data-activated','false' );
					message.html( '' );
					message.css({'margin-left': '0px', 'margin-right': '0px'});
				}
			}, 1000 );
		});
	}

	// For checking for, and displaying error message if, passwords don't match.
	function medwestPasswordMatching() {

		$( document ).on( 'keyup', '.medwesthealthpoints-form-section-fields-indiv-wrapper-passwordconfirmblock input', function( event ) {

			// Get the wrapper element...
			var wrapper = $(this).parent().parent();

			// Get the two E-Mail values
			var password = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-password' ).val().toLowerCase();
			var passwordConfirm = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-passwordconfirm' ).val().toLowerCase();
			var message = wrapper.find( '.medwesthealthpoints-confirmpassword-block-message-div' );

			setTimeout( function() {
				if ( password !== passwordConfirm ) {
					message.attr( 'data-activated','true' );
					message.html( 'Passwords Don\'t Match!' );
					message.css({'color': '#DE235A', 'margin-left': '10px', 'margin-right': '10px'});
					message.animate({'opacity': '1'}, 300 );
				} else {
					message.attr( 'data-activated','false' );
					message.html( '' );
					message.css({'margin-left': '0px', 'margin-right': '0px'});
				}
			}, 1000 );
		});
	}

	function medwestExpandRegisterForm(){
		
		$( document ).on( 'click', '#medwesthealthpoints-join-as-vet', function( event ) {

			var form = $( '#medwesthealthpoints-dashboard-veteran-join-form-wrapper' );

			// Get Auto Height
			var autoHeight = form.css('height', 'auto').height(); 
			// Reset to Default Height
			form.height(0); 
			// Animate to Auto Height
			form.stop().animate({
			 height: autoHeight+50,
			 opacity:1
			}, {
			 duration: 1000,
			});
		});
	}

	function medwestJoinHealthPoints(){

		$( document ).on( 'keyup change', '.medwesthealthpoints-form-section-fields-input, #medwesthealthpoints-form-vetstate', function( event ) {
			$( this ).prev().css({'color':'initial'});
		});

		$( document ).on( 'click', '.medwesthealthpoints-form-section-fields-input-button-apply', function( event ) {

			// Resetting red labels that may have been set from missing data...
			//$('.medwesthealthpoints-form-section-fields-label').css({'color':'initial'});
		
			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})
			$( '#medwesthealthpoints-displayentries-response-div-actual-container' ).text( '' )

			var userfirstname = $('#medwesthealthpoints-form-firstname').val();
			var useridnumber = $('#medwesthealthpoints-form-firstnum').val();
			var userlastname = $('#medwesthealthpoints-form-lastname').val();
			var useremail = $('#medwesthealthpoints-form-email-veteran').val();
			var userpassword = $('#medwesthealthpoints-form-password-vet').val();
			var useremailconfirm = $('#medwesthealthpoints-form-confirmemail-veteran').val();
			var userpasswordconfirm = $('#medwesthealthpoints-form-confirmpassword-vet').val();
			var userdepartment = $( '#medwesthealthpoints-form-vetstate' ).val();

			var idtosearchthrough = $( this ).attr( 'data-idtosearchthrough' );
			var requiredNotFound = [];

			if ( '' === userfirstname || null === userfirstname || undefined === userfirstname ) {
				requiredNotFound.push( 'medwesthealthpoints-form-firstname' )
			}

			if ( '' === userlastname || null === userlastname || undefined === userlastname ) {
				requiredNotFound.push( 'medwesthealthpoints-form-lastname' )
			}

			if ( '' === useremail || null === useremail || undefined === useremail ) {
				requiredNotFound.push( 'medwesthealthpoints-form-email-veteran' )
			}

			if ( '' === userpassword || null === userpassword || undefined === userpassword ) {
				requiredNotFound.push( 'medwesthealthpoints-form-password-vet' )
			}

			if ( '' === useremailconfirm || null === useremailconfirm || undefined === useremailconfirm ) {
				requiredNotFound.push( 'medwesthealthpoints-form-confirmemail-veteran' )
			}

			if ( '' === userpasswordconfirm || null === userpasswordconfirm || undefined === userpasswordconfirm ) {
				requiredNotFound.push( 'medwesthealthpoints-form-confirmpassword-vet' )
			}

			if ( '' === useridnumber || null === useridnumber || undefined === useridnumber ) {
				requiredNotFound.push( 'medwesthealthpoints-form-firstnum' )
			}

			if ( null === userdepartment ) {
				requiredNotFound.push( 'medwesthealthpoints-form-vetstate' )
			}



			


			// Double-check that the E-Mail addresses match before proceeding
			if( 0 < $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmemail-block-message-div' ).length && 'true' === $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmemail-block-message-div' ).attr( 'data-activated' ) ) {
				requiredNotFound.push( idtosearchthrough + ' .medwesthealthpoints-confirmemail-block-message-div' );
			}

			// Double-check that the E-Mail addresses match before proceeding
			if( 0 < $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmpassword-block-message-div' ).length && 'true' === $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmpassword-block-message-div' ).attr( 'data-activated' ) ) {
				requiredNotFound.push( idtosearchthrough + ' .medwesthealthpoints-confirmpassword-block-message-div' );
			}

			if ( 0 < requiredNotFound.length ) {
				for (var i = 0; i < requiredNotFound.length; i++) {
					$( '#' + requiredNotFound[i] ).prev().css({'color':'red'});
				}

				// Turn off spinner...
        		$( this ).next().animate({'opacity':0}, 300);
        		console.log(requiredNotFound)
        		if ( requiredNotFound[0] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmemail-block-message-div" || requiredNotFound[1] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmemail-block-message-div" ){
        			alert( 'Whoops! Looks like your E-Mail Addresses don\'t match!' );
        		} else if ( requiredNotFound[0] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmpassword-block-message-div" || requiredNotFound[1] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmpassword-block-message-div" ){
        			alert( 'Whoops! Looks like your Passwords don\'t match!' );
        		} else {
        			alert( 'Whoops! Looks like you might have missed providing some required information!' );
        		}
				
				$("html, body").animate({ scrollTop: $('#'+requiredNotFound[0]).offset().top-150 }, 1000);

			} else {

				var data = {
		          'action': 'medwesthealthpoints_register_new_user_action',
		          'security': medwestHealthpointsPhpVariables.adminnonce1,
		          'userfirstname':userfirstname,
		          'userlastname':userlastname,
		          'useremail':useremail,
		          'userpassword':userpassword,
		          'userdepartment': userdepartment,
		          'useridnumber': useridnumber
		        };

	        	console.log('This is the data being sent to the server to create a new user');
	        	console.log(data);


				var request = $.ajax({
					url: ajaxurl,
					type: "POST",
					data:data,
					timeout: 0,
					success: function(response) {

						// Hide spinner
						$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
						console.log(response);

						if ( 'Username Exists' === response ) {
							$( '.medwesthealthpoints-displayentries-response-div-actual-container' ).text( 'Whoops! Looks like someone with this Email address already exists! Please try a different Email address.' )
						} else if ( 'Unknown error creating WordPress User' === response ) {

							$( '.medwesthealthpoints-displayentries-response-div-actual-container' ).text( 'Hmm... looks like we\'ve run into some kind of error! Please try again later.'  );

						} else {

							$( '.medwesthealthpoints-displayentries-response-div-actual-container' ).text( 'Success!'  );

							var username = response.split( '--$user_id--' );
							//window.location.href = window.location.href + '?un=' + username[1];

						}

					

					},
					error: function(jqXHR, textStatus, errorThrown) {
						console.log(errorThrown);
						console.log(textStatus);
						console.log(jqXHR);
					}
				});


			}






			

		});

	}


});
