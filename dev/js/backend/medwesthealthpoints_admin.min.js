/**
 * JavaScript Admin Functions - medwesthealthpoints-admin.min.js
 *
 * @author   Jake Evans
 * @category JavaScript
 * @package  Includes/Assets/Js
 * @version  6.0.0
 */

console.log( 'This is the JavaScript Object that holds all PHP Variables for use in the medwesthealthpoints Admin JavaScript file:' );
console.log( medwestHealthpointsPhpVariables );


// All functions wrapped in jQuery( document ).ready()...
jQuery( document ).ready( function( $ ) {
	'use strict';

	/* BEGINNING SECTION TO CALL ALL FUNCTIONS IN FILE... */

	// Function to display the admin pointer message when entering the Question Mark image with mouse...
	medwestHealthpointsAdminPointersJavascript();

	// Function that will handle the saving of the user's License Key.
	medwestHealthpointsPluginPageDashboardSaveKey();

	// Function for approving an activity from the Admin menu.
	medwestHealthpointsApproveActivity();

	// Function for approving a Reward from the Admin menu.
	medwestHealthpointsApproveReward();

	// Function to deny pending Rewards.
	medwestHealthpointsDenyReward();

	// Function to deny pending Activities.
	medwestHealthpointsDenyActivity();

	// Function for enabling the 'Upload Files' buttons.
	medWestWordPressFileUpload();

	// This is a function to let the admin create a new reward.
	medWestCreateNewReward();

	// This is a function to edit rewards.
	medWestEditReward();

	// This is a function to delete rewards.
	medWestDeleteReward();

	// This is a function to let the admin create a new Activity.
	medWestCreateNewActivity();

	// This is a function to let the admin edit an activity.
	medWestEditActivity();

	// This is a function to delete activity.
	medWestDeleteActivity();

	// Function that makes sure e-mail addresses match.
	medwestEmailMatching();

	// For checking for, and displaying error message if, passwords don't match.
	medwestPasswordMatching();

	// Function to register a user for HealthPoints.
	medwestJoinHealthPoints();

	// This is a function to allow the admin to bulk-upload users.
	medWestBulkUploadUsers();

	// Function to expand individual users 
	medWestExpandEditDeleteUsers();

	// Function to save edits to a user
	medWestEditUser();

	// Function for switching to the next page of books on the 'Edit & Delete Books' tab
	medWestEditBookPagination();

	// Function to view a user's saved Activities.
	medWestViewUserActsAdmin();

	// Function to expand the deny pending Activities section.
	medwestHealthpointsExpandDenyActivity();

	// Function to enable the final deny activity button.
	medwestHealthpointsFinalEnableDenyActivity();

	// Function to reveal the User checkboxes...
	medWestExpandUsersOnNewActivity();

	// Function to check all the User checkboxes...
	medWestCheckAllUsersOnNewActivity();

	// Function to uncheck all the User checkboxes...
	medWestUncheckAllUsersOnNewActivity();

	// Function to check all the User checkboxes...
	function medWestCheckAllUsersOnNewActivity(){
		$( document ).on( 'click', '#medwest-create-activity-checkall-button', function( event ) {
			$('.medwest-addusertoactivity-checkbox-actual').each(function(index){
				$( this ).prop( "checked", true );
			});
		});
	}

	// Function to uncheck all the User checkboxes...
	function medWestUncheckAllUsersOnNewActivity(){
		$( document ).on( 'click', '#medwest-create-activity-uncheckall-button', function( event ) {
			$('.medwest-addusertoactivity-checkbox-actual').each(function(index){
				$( this ).prop( "checked", false );
			});
		});
	}

	// Function to reveal the User checkboxes...
	function medWestExpandUsersOnNewActivity(){
		$( document ).on( 'change', '#medwest-input-adduserstoactivity', function( event ) {

			if( 'Yes' === $( this ).val() ){

				// Calling the function that will supposedly prevent computers from sleeping to further ensure backup success
				sleep.prevent();

				var newIdRef = $( '.medwest-adduserstoactivity-checkbox-holder' );
				 // Get Auto Height
				var autoHeight = newIdRef.css('height', 'auto').height(); 
				// Reset to Default Height
				newIdRef.height(0); 
				// Animate to Auto Height
				newIdRef.stop().animate({
				 height: autoHeight+50,
				 opacity:1
				}, {
				 duration: 1000,
				});
			} else {
				var newIdRef = $( '.medwest-adduserstoactivity-checkbox-holder' );
				// Reset to Default Height
				newIdRef.height(0); 
				// Animate to Auto Height
				newIdRef.stop().animate({
				 height: 0,
				 opacity:0
				}, {
				 duration: 1000,
				});
			}
		});
	}


	// Function for switching to the next page of books on the 'Edit & Delete Books' tab
	function medWestEditBookPagination() {

		// Set initial offset in dom
		$( '.medwesthpplugin-admin-top-title' ).attr( 'data-offset', 0 );

		// Get offset value from medwest.php, convert to int
		var offset = 50;
		offset = parseInt( offset );


		$( document ).on( 'click', '#medwest-edit-next-100, #medwest-edit-previous-100', function( event ) {

			// Grabbing offset from dom
			var currentOffset = parseInt( $( '.medwesthpplugin-admin-top-title' ).attr( 'data-offset' ));

			var middlePagination = $( '.medwest-pagination-middle-div-select' ).val();

			// Grabbing total number of books in library
			var limit = parseInt( $( this ).attr( 'data-limit' ));

			// Ensuring we don't go backwards if we're already on the first set results
			if ( $( this ).attr( 'id' ) == 'medwest-edit-previous-100' ) {
				var direction = 'back';
			} else {
				var direction = 'forward';
			}

			// Ensuring we don't go backwards if we're already on the first set results
			if ( direction == 'back' &&  ( currentOffset-offset ) < 0 ) {
				return;
			}

			// Ensuring we don't go over the total # of books in library
			if ( direction == 'forward' &&  ( currentOffset+offset ) > limit ) {
				return;
			}

			// Initial UI Stuff
			$( '.medwesthealthpoints-dashboard-join-form-wrapper' ).animate({ 'opacity': '0.3'}, 500 );
			$( '#medwest-spinner-pagination' ).animate({ 'opacity': '1'}, 500 );

			if ( direction == 'forward' ) {
				currentOffset = currentOffset+offset;
				$( '.medwesthpplugin-admin-top-title' ).attr( 'data-offset', currentOffset );
			} else {
				currentOffset = currentOffset-offset;
				$( '.medwesthpplugin-admin-top-title' ).attr( 'data-offset', currentOffset );
			}

			var data = {
				'action': 'medwesthealthpoints_edit_book_pagination_action',
				'security': medwestHealthpointsPhpVariables.adminnonce16,
				'currentOffset': currentOffset,
			};

			console.log(data);

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					console.log(response);

					response = response.split( '_Separator_' );

					// Resetting iniail UI stuff
					$( '.medwesthealthpoints-dashboard-join-form-wrapper' ).animate({ 'opacity': '1'}, 500 );
					$( '#medwest-spinner-pagination' ).animate({ 'opacity': '0'}, 500 );

					// Clear existing books and replace with the response
					$( '.medwest-admin-top-inner-container' ).html( '' );
					$( '.medwesthpplugin-admin-top-inner-container' ).html( response[0]);

					if ( 'back' === direction &&  ( currentOffset - offset ) < 0 ) {
						$( '#medwest-edit-previous-100' ).css({ 'pointer-events': 'none', 'opacity': '0.3' });
					} else {
						$( '#medwest-edit-previous-100' ).css({ 'pointer-events': 'all', 'opacity': '1' });
					}

					if ( 'forward' === direction &&  ( currentOffset + offset ) >= limit ) {
						$( '#medwest-edit-next-100' ).css({ 'pointer-events': 'none', 'opacity': '0.3' });
					} else {
						$( '#medwest-edit-next-100' ).css({ 'pointer-events': 'all', 'opacity': '1' });
					}

					if ( 'back' === direction ) {
						console.log('tracker5')
						console.log('value is: ' + ( parseInt( middlePagination ) - 50 ) );
						console.log('currentoffset is : ' + currentOffset );
						$( '.medwest-pagination-middle-div-select' ).val( currentOffset );
					} else {
						console.log('tracker6')
						console.log('value is: ' + ( parseInt( middlePagination ) + 50 ) );
						console.log('currentoffset is : ' + currentOffset );
						$( '.medwest-pagination-middle-div-select' ).val( currentOffset );
					}

				}

			});
		});

		// The change listend for the middle Page Select Drop-Down.
		$( document ).on( 'change', '.medwest-pagination-middle-div-select', function( event ) {

			var data = [];
			var currentOffset = '';
			var initialNextOpacity = '';
			var initialPrevOpacity = '';
			var library = '';
			var request = '';

			// Initial UI Stuff
			$( '.medwesthealthpoints-dashboard-join-form-wrapper' ).animate({ 'opacity': '0.3'}, 500 );
			$( '#medwest-spinner-pagination' ).animate({ 'opacity': '1'}, 500 );
			initialNextOpacity = $( '#medwest-edit-next-100' ).css( 'opacity' );
			initialPrevOpacity = $( '#medwest-edit-previous-100' ).css( 'opacity' );

			$( '#medwest-edit-next-100' ).css({ 'opacity': '0.3' });
			$( '#medwest-edit-previous-100' ).css({ 'opacity': '0.3' });

			// Grabbing offset from dom
			currentOffset = parseInt( $( this ).val() );

			$( '.medwesthpplugin-admin-top-title' ).attr( 'data-offset', currentOffset );

			data = {
				'action': 'medwesthealthpoints_edit_book_pagination_action',
				'security': medwestHealthpointsPhpVariables.adminnonce16,
				'currentOffset': currentOffset,
			};

			request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					var currentOffset = '';
					var dataLimit = '';

					response = response.split( '_Separator_' );

					// Resetting iniail UI stuff
					$( '.medwesthealthpoints-dashboard-join-form-wrapper' ).animate({ 'opacity': '1'}, 500 );
					$( '#medwest-spinner-pagination' ).animate({ 'opacity': '0'}, 500 );

					if ( 1 === initialNextOpacity ) {
						$( '#medwest-edit-next-100' ).css({ 'opacity': '1' });
					}

					if ( 1 === initialPrevOpacity ) {
						$( '#medwest-edit-Previous-100' ).css({ 'opacity': '1' });
					}

					// Clear existing books and replace with the response
					$( '.medwest-admin-top-inner-container' ).html( '' );
					$( '.medwesthpplugin-admin-top-inner-container' ).html( response[0]);

					// Grabbing offset from dom
					currentOffset = $( '.medwesthpplugin-admin-top-title' ).attr( 'data-offset' );
					dataLimit = $( '.medwest-pagination-middle-div-select' ).attr( 'data-limit' );

					console.log( 'currentOffset is: ' + currentOffset );
					console.log( 'dataLimit is: ' + dataLimit );

					console.log( 'currentoffset plus edit_page_offset is: ' + (parseInt( currentOffset ) + parseInt( 50 ) ) );

					if ( parseInt( currentOffset ) + parseInt( 50 ) >= parseInt( dataLimit ) ) {
						console.log('tracker1')
						$( '#medwest-edit-next-100' ).css({ 'pointer-events': 'none', 'opacity': '0.3' });
					} else {
						console.log('tracker2')
						$( '#medwest-edit-next-100' ).css({ 'pointer-events': 'all', 'opacity': '1' });
					}

					if ( parseInt( 50 ) >= parseInt( currentOffset ) ) {
						console.log('tracker3')
						$( '#medwest-edit-previous-100' ).css({ 'pointer-events': 'none', 'opacity': '0.3' });
					} else {
						$( '#medwest-edit-previous-100' ).css({ 'pointer-events': 'all', 'opacity': '1' });
						console.log('tracker4')
						
					}

					$( '.medwest-pagination-middle-div-select' ).val( currentOffset );

				}

			});
		});
	}

	// Function to view a user's saved Activities.
	function medWestViewUserActsAdmin(){

		$( document ).on( 'click', '.medwesthealthpoints-form-section-fields-input-button-view-acts', function( event ) {

			var wrapper = $(this).parent();
			var activityemployeeid = $(this).attr('data-employeeid');
			wrapper.find('.medwesthealthpoints-spinner').css('opacity',1)

			if( 'View User Activities' === $(this).text() ){

				var data = {
		          'action': 'medwesthealthpoints_view_user_activity_action',
		          'security': medwestHealthpointsPhpVariables.adminnonce17,
		          'activityemployeeid':activityemployeeid,
		        };

	        	console.log('This is the data being sent to the server to create a new user');
	        	console.log(data);


				var request = $.ajax({
					url: ajaxurl,
					type: "POST",
					data:data,
					timeout: 0,
					success: function(response) {
						//console.log(response);
						//response = JSON.parse( response );
						console.log(response);
						wrapper.find('.medwest-view-user-activities-wrapper').html(response);
						wrapper.find('.medwesthealthpoints-spinner').css('opacity',0);
						wrapper.find('.medwesthealthpoints-form-section-fields-input-button-view-acts').text('Hide User Activities');
						//document.location.reload( true );
						
					},
					error: function(jqXHR, textStatus, errorThrown) {
						console.log(errorThrown);
						console.log(textStatus);
						console.log(jqXHR);
					}
				});

			} else {
				wrapper.find('.medwest-view-user-activities-wrapper').html('');
				wrapper.find('.medwesthealthpoints-form-section-fields-input-button-view-acts').text('View User Activities');
				wrapper.find('.medwesthealthpoints-spinner').css('opacity',0);
			}
			


		});

	}

	function medWestEditUser(){

		$( document ).on( 'click', '.medwesthealthpoints-form-section-fields-input-button-edit', function( event ) {

			var id = $(this).attr('id');
			id = id.replace( 'button', 'wrapper' );
			var wrapper = $('#'+id);
			var userfirstname = '';
			var userlastname = '';
			var useremail = '';
			var useremailconfirm = '';
			var userdepartment = '';
			var useridnumber = '';
			var userdepartment = '';
			var userhealthpoints = '';
			var addactivitytouserclass = '';
			var useridnumber = $( this ).attr( 'data-useridnumber' );
			var activitywpuserid = $( this ).attr( 'data-activitywpuserid' );
			//var required = $( this ).parent().find( '.medwest-activity-dropdown-actual option:selected', this).attr('data-requireddocs');


			wrapper.find('.medwesthealthpoints-spinner').css('opacity',1)


			wrapper.find('input').each(function(){

				if( -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-firstname' ) ){
					userfirstname = $(this).val();
				}

				if( -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-lastname' ) ){
					userlastname = $(this).val();
				}

				if( -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-email-veteran' ) ){
					useremail = $(this).val();
				}

				if( -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-confirmemail-veteran' ) ){
					useremailconfirm = $(this).val();
				}

				if( -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-employeenum' ) ){
					useridnumber = $(this).val();
				}

				if( -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-healthpoints' ) ){
					userhealthpoints = $(this).val();
				}

				//console.log($(this))
			})

			wrapper.find('select').each(function(){

				if( undefined !== $(this).attr('id') && -1 < $(this).attr('id').indexOf( 'medwesthealthpoints-form-vetstate' ) ){
					userdepartment = $(this).val();
				}

				if( 'medwest-add-user-to-activity-while-editing' === $( this ).attr( 'class' )  ){
					addactivitytouserclass = $(this).find( 'option:selected', this);
				}

				//console.log($(this))
			})


			if( useremail !== useremailconfirm ){

				wrapper.find('.medwesthealthpoints-confirmemail-block-message-div').html('<p>Whoops! Make sure the<br/>email addresses match exactly!</p>');
				wrapper.find('.medwesthealthpoints-confirmemail-block-message-div').css({'color':'rgb(222, 35, 90)', 'margin-left':'10px', 'margin-right':'10px', 'opacity':'1'});
				wrapper.find('.medwesthealthpoints-spinner').css('opacity',0)
			} else {

				var data = {
		          'action': 'medwesthealthpoints_edit_existing_user_action',
		          'security': medwestHealthpointsPhpVariables.adminnonce15,
		          'userfirstname':userfirstname,
		          'userlastname':userlastname,
		          'useremail':useremail,
		          'userdepartment': userdepartment,
		          'useridnumber': useridnumber,
		          'userhealthpoints':userhealthpoints,
		        };

	        	console.log('This is the data being sent to the server to create a new user');
	        	console.log(data);


				var request = $.ajax({
					url: ajaxurl,
					type: "POST",
					data:data,
					timeout: 0,
					success: function(response) {
						console.log(response);

						// Now work on adding the Activity to the User, if that option was choosen.
						if ( null !== addactivitytouserclass.val() && '' !== addactivitytouserclass.val() && 'Choose an Activity...' !== addactivitytouserclass.val() && 'Default' !== addactivitytouserclass.val() ) {

								var activityname = addactivitytouserclass.attr( 'data-activityname' );
								var activitycategory = addactivitytouserclass.attr( 'data-activitycategory' );
								var activitypoints = addactivitytouserclass.attr( 'data-activitypoints' );

 								var d = new Date();

								var data = {
						          'action': 'medwesthealthpoints_save_activity_user_action',
						          'security': medwestHealthpointsPhpVariables.adminnonce2,
						          'activityname':activityname,
						          'activitycategory':activitycategory,
						          'activitydateperformed':d.getFullYear() + '-' + d.getMonth() + '-' + d.getDate(),
						          'activitysupportingdocs':'Admin Assigned - No Supporting Docs',
						          'activitywpuserid': activitywpuserid,
						          'activityemployeeid': useridnumber,
						          'activitystatus': 'Approved',
						        };

					        	console.log('This is the data being sent to the server to save a user\'s activity' );
					        	console.log(data);

								var request = $.ajax({
									url: ajaxurl,
									type: "POST",
									data:data,
									timeout: 0,
									success: function(response) {
										console.log(response);

										// Since we added the Activity to the user correctly, we now need to give them HealthPoints
							    		var data = {
								          'action': 'medwesthealthpoints_approve_activities_user_action',
								          'security': medwestHealthpointsPhpVariables.adminnonce4,
								          'useridnumber':useridnumber,
								          'userhealthpoints': parseInt( userhealthpoints ) + parseInt( activitypoints ),
								        };

							        	console.log('This is the data being sent to the server to create a new user');
							        	console.log(data);


										var request = $.ajax({
											url: ajaxurl,
											type: "POST",
											data:data,
											timeout: 0,
											success: function(response) {
												console.log(response);
												document.location.reload(true);
												
											},
											error: function(jqXHR, textStatus, errorThrown) {
												console.log(errorThrown);
												console.log(textStatus);
												console.log(jqXHR);
											}
										});
											
									},
									error: function(jqXHR, textStatus, errorThrown) {
										console.log(errorThrown);
										console.log(textStatus);
										console.log(jqXHR);
									},
									complete: function() {
										
								    }
								});
						} else {
							document.location.reload( true );
						}





						
					},
					error: function(jqXHR, textStatus, errorThrown) {
						console.log(errorThrown);
						console.log(textStatus);
						console.log(jqXHR);
					}
				});

			}


		});

	}

	function medWestExpandEditDeleteUsers(){

		$( document ).on( 'click', '.medwesthealthpoints-user-title-div', function( event ) {

			var userDiv = $( this ).next();
			var controllerDiv = $(this);

			if ( 'closed' === controllerDiv.attr('data-state') ) {

				var autoHeight = 0;

				// Get Default Height
				var curHeight = userDiv.height();

				// Get Auto Height
				autoHeight = userDiv.css( 'height', 'auto' ).height();

				// Reset to Default Height
				userDiv.height( curHeight );

				// Animate to Auto Height
				userDiv.stop().animate({
					height: autoHeight,
					opacity: 1,
				}, {
					duration: 1000,
					complete: function() {
						userDiv.css({'height': 'auto'});
						controllerDiv.attr('data-state', 'open')
						
					}
				});
			} else {

				// Animate to Auto Height
				userDiv.stop().animate({
					height: '0px',
					opacity: 0,
				}, {
					duration: 1000,
					complete: function() {
						controllerDiv.attr('data-state', 'closed')	
					}
				});
			}
		});
	}

	function medwestJoinHealthPoints(){

		$( document ).on( 'keyup change', '.medwesthealthpoints-form-section-fields-input, #medwesthealthpoints-form-vetstate', function( event ) {
			$( this ).prev().css({'color':'initial'});
		});

		$( document ).on( 'click', '.medwesthealthpoints-form-section-fields-input-button-apply', function( event ) {

			// Resetting red labels that may have been set from missing data...
			//$('.medwesthealthpoints-form-section-fields-label').css({'color':'initial'});
		
			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})
			$( '#medwesthealthpoints-displayentries-response-div-actual-container' ).text( '' )

			var userfirstname = $('#medwesthealthpoints-form-firstname').val();
			var useridnumber = $('#medwesthealthpoints-form-firstnum').val();
			var userlastname = $('#medwesthealthpoints-form-lastname').val();
			var useremail = $('#medwesthealthpoints-form-email-veteran').val();
			var userpassword = $('#medwesthealthpoints-form-password-vet').val();
			var useremailconfirm = $('#medwesthealthpoints-form-confirmemail-veteran').val();
			var userpasswordconfirm = $('#medwesthealthpoints-form-confirmpassword-vet').val();
			var userdepartment = $( '#medwesthealthpoints-form-vetstate' ).val();
			var userhealthpoints = $( '#medwesthealthpoints-form-healthpoints' ).val();

			var idtosearchthrough = $( this ).attr( 'data-idtosearchthrough' );
			var requiredNotFound = [];

			if ( '' === userfirstname || null === userfirstname || undefined === userfirstname ) {
				requiredNotFound.push( 'medwesthealthpoints-form-firstname' )
			}

			if ( '' === userlastname || null === userlastname || undefined === userlastname ) {
				requiredNotFound.push( 'medwesthealthpoints-form-lastname' )
			}

			if ( '' === useremail || null === useremail || undefined === useremail ) {
				requiredNotFound.push( 'medwesthealthpoints-form-email-veteran' )
			}

			if ( '' === userpassword || null === userpassword || undefined === userpassword ) {
				requiredNotFound.push( 'medwesthealthpoints-form-password-vet' )
			}

			if ( '' === useremailconfirm || null === useremailconfirm || undefined === useremailconfirm ) {
				requiredNotFound.push( 'medwesthealthpoints-form-confirmemail-veteran' )
			}

			if ( '' === userpasswordconfirm || null === userpasswordconfirm || undefined === userpasswordconfirm ) {
				requiredNotFound.push( 'medwesthealthpoints-form-confirmpassword-vet' )
			}

			if ( '' === useridnumber || null === useridnumber || undefined === useridnumber ) {
				requiredNotFound.push( 'medwesthealthpoints-form-firstnum' )
			}

			if ( '' === userhealthpoints || null === userhealthpoints || undefined === userhealthpoints ) {
				requiredNotFound.push( 'medwesthealthpoints-form-healthpoints' )
			}

			if ( null === userdepartment ) {
				requiredNotFound.push( 'medwesthealthpoints-form-vetstate' )
			}



			


			// Double-check that the E-Mail addresses match before proceeding
			if( 0 < $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmemail-block-message-div' ).length && 'true' === $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmemail-block-message-div' ).attr( 'data-activated' ) ) {
				requiredNotFound.push( idtosearchthrough + ' .medwesthealthpoints-confirmemail-block-message-div' );
			}

			// Double-check that the E-Mail addresses match before proceeding
			if( 0 < $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmpassword-block-message-div' ).length && 'true' === $( '#' + idtosearchthrough + ' .medwesthealthpoints-confirmpassword-block-message-div' ).attr( 'data-activated' ) ) {
				requiredNotFound.push( idtosearchthrough + ' .medwesthealthpoints-confirmpassword-block-message-div' );
			}

			if ( 0 < requiredNotFound.length ) {
				for (var i = 0; i < requiredNotFound.length; i++) {
					$( '#' + requiredNotFound[i] ).prev().css({'color':'red'});
				}

        		if ( requiredNotFound[0] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmemail-block-message-div" || requiredNotFound[1] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmemail-block-message-div" ){
        			alert( 'Whoops! Looks like your E-Mail Addresses don\'t match!' );
        			$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
        		} else if ( requiredNotFound[0] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmpassword-block-message-div" || requiredNotFound[1] === "medwesthealthpoints-dashboard-veteran-join-form-wrapper .medwesthealthpoints-confirmpassword-block-message-div" ){
        			alert( 'Whoops! Looks like your Passwords don\'t match!' );
        			$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
        		} else {
        			alert( 'Whoops! Looks like you might have missed providing some required information!' );
        			$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
        		}
				
				$("html, body").animate({ scrollTop: $('#'+requiredNotFound[0]).offset().top-150 }, 1000);

			} else {

				var data = {
		          'action': 'medwesthealthpoints_register_new_user_action',
		          'security': medwestHealthpointsPhpVariables.adminnonce1,
		          'userfirstname':userfirstname,
		          'userlastname':userlastname,
		          'useremail':useremail,
		          'userpassword':userpassword,
		          'userdepartment': userdepartment,
		          'useridnumber': useridnumber,
		          'userhealthpoints':userhealthpoints,
		        };

	        	console.log('This is the data being sent to the server to create a new user');
	        	console.log(data);


				var request = $.ajax({
					url: ajaxurl,
					type: "POST",
					data:data,
					timeout: 0,
					success: function(response) {

						// Hide spinner
						$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
						console.log(response);

						if ( 'Username Exists' === response ) {
							$( '.medwesthealthpoints-displayentries-response-div-actual-container' ).text( 'Whoops! Looks like someone with this Email address already exists! Please try a different Email address.' )
						} else if ( 'Unknown error creating WordPress User' === response ) {
							$( '.medwesthealthpoints-displayentries-response-div-actual-container' ).text( 'Hmm... looks like we\'ve run into some kind of error! Please try again later.'  );
						} else {

							$( '.medwesthealthpoints-displayentries-response-div-actual-container' ).text( 'Success!'  );

							setTimeout( function(){
								document.location.reload( true );
							}, 3000 )
						}
					},
					error: function(jqXHR, textStatus, errorThrown) {
						console.log(errorThrown);
						console.log(textStatus);
						console.log(jqXHR);
					}
				});
			}
		});
	}

	// For checking for, and displaying error message if, passwords don't match.
	function medwestPasswordMatching() {

		$( document ).on( 'keyup', '.medwesthealthpoints-form-section-fields-indiv-wrapper-passwordconfirmblock input', function( event ) {

			// Get the wrapper element...
			var wrapper = $(this).parent().parent();

			// Get the two E-Mail values
			var password = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-password' ).val().toLowerCase();
			var passwordConfirm = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-passwordconfirm' ).val().toLowerCase();
			var message = wrapper.find( '.medwesthealthpoints-confirmpassword-block-message-div' );

			setTimeout( function() {
				if ( password !== passwordConfirm ) {
					message.attr( 'data-activated','true' );
					message.html( 'Passwords Don\'t Match!' );
					message.css({'color': '#DE235A', 'margin-left': '10px', 'margin-right': '10px'});
					message.animate({'opacity': '1'}, 300 );
				} else {
					message.attr( 'data-activated','false' );
					message.html( '' );
					message.css({'margin-left': '0px', 'margin-right': '0px'});
				}
			}, 1000 );
		});
	}

	// For checking for, and displaying error message if, emails don't match.
	function medwestEmailMatching() {

		$( document ).on( 'keyup', '.medwesthealthpoints-form-section-fields-indiv-wrapper-emailconfirmblock input', function( event ) {

			// Get the wrapper element...
			var wrapper = $(this).parent().parent();

			// Get the two E-Mail values
			var email = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-email' ).val().toLowerCase();
			var emailConfirm = wrapper.find( '.medwesthealthpoints-form-section-fields-input-text-emailconfirm' ).val().toLowerCase();
			var message = wrapper.find( '.medwesthealthpoints-confirmemail-block-message-div' );

			setTimeout( function() {
				if ( email !== emailConfirm ) {
					message.attr( 'data-activated','true' );
					message.html( 'E-Mails Don\'t Match!' );
					message.css({'color': '#DE235A', 'margin-left': '10px', 'margin-right': '10px'});
					message.animate({'opacity': '1'}, 300 );
				} else {
					message.attr( 'data-activated','false' );
					message.html( '' );
					message.css({'margin-left': '0px', 'margin-right': '0px'});
				}
			}, 1000 );
		});
	}

	//masking();

	function masking(){
		var phoneMask = IMask(
			document.getElementById('medwesthpplugin-form-contactphone'), {
		    mask: '(000) 000-0000'
		});
	}



	// Function that will handle the saving of the user's License Key.
	function medwestHealthpointsPluginPageDashboardSaveKey() {

		// When the 'Save' button is clicked at the top of the dashboard...
		$( '#medwesthpplugin-extension-genreric-key-dashboard-form-toplevel' ).on( 'submit', function() {

			var license = $( '#medwesthpplugin-extension-genreric-key-dashboard-input-toplevel' ).val();

			// Make Ajax call to get display options.
			var data = {
				'action': 'medwesthealthpoints_save_license_key_action',
				'security': medwestHealthpointsPhpVariables.adminnonce1,
				'license': license
			};

			console.log(data);

			$.post( ajaxurl, data, function( response ) {

				document.location.reload( true );

			});


			event.preventDefault ? event.preventDefault() : event.returnValue = false;

		});

		// When the 'Save' button is clicked from the plugin's entry...
		$( '#medwesthpplugin-extension-genreric-key-plugins-page-button-toplevel' ).on( 'click', function() {

			var license = $( this ).prev().val();

			// Make Ajax call to get display options.
			var data = {
				'action': 'medwesthealthpoints_save_license_key_action',
				'security': medwestHealthpointsPhpVariables.adminnonce1,
				'license': license
			};

			console.log(data);

			$.post( ajaxurl, data, function( response ) {

				document.location.reload( true );

			});
			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}


	/* ENDING SECTION TO CALL ALL FUNCTIONS IN FILE... */

	// Function to display the admin pointer message when entering the Question Mark image with mouse...
	function medwestHealthpointsAdminPointersJavascript() {

		$( 'body' ).on( 'mouseenter', '.medwesthpplugin-icon-image-question', function() {

			var label = $( this ).attr( 'data-label' );
			var pointer;

			// Switch for which admin message to display.
			switch ( label ) {
			case 'book-form-isbn10':
				pointer = $( this ).pointer({
					content: '<h3>' + medwesthppluginPhpVariables.trans135 + '</h3><p class="medwesthpplugin-admin-pointer">' + medwesthppluginPhpVariables.trans173 + '.</p>',
					position: {
						edge: 'right',
						align: 'right'
					}
				});
				break;
			default:
			}

			// Open the pointer on mouseenter.
			pointer.pointer( 'open' );

			// Close the pointer on mouseleave.
			$( 'body' ).on( 'mouseleave', '.medwesthpplugin-icon-image-question', function() {
				pointer.pointer( 'close' );
			});

		});

		$( 'body' ).on( 'mouseenter', '.medwesthpplugin-icon-image-question-with-link', function() {

			var label = $( this ).attr( 'data-label' );
			var pointer;

			// Switch for which admin message to display
			switch ( label ) {
			case 'book-form-libraries':
				pointer = $( this ).pointer({
					content: '<h3>' + medwesthppluginPhpVariables.trans203 + '</h3><p class="medwesthpplugin-admin-pointer">' + medwesthppluginPhpVariables.trans204 + medwesthppluginPhpVariables.SETTINGS_PAGE_URL + medwesthppluginPhpVariables.trans205 + '.</p>',
					position: {
						edge: 'right',
						align: 'right'
					}
				});
				break;
			default:
			}

			// Open the pointer on mouseenter
			pointer.pointer( 'open' );

		});
	}

	// Function to approve pending Activities.
	function medwestHealthpointsApproveActivity(){

		$( document ).on( 'click', '.medwest-activity-approve-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var useridnumber = $( this ).attr( 'data-useremployeeid' );
			var activityid = $( this ).attr( 'data-activityid' );
			var userhealthpoints = $( this ).attr( 'data-userhealthpoints' );


			var data = {
	          'action': 'medwesthealthpoints_approve_activities_user_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce4,
	          'useridnumber':useridnumber,
	          'activityid':activityid,
	          'userhealthpoints':userhealthpoints,
	        };

        	console.log('This is the data being sent to the server to create a new user');
        	console.log(data);


			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true);
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});

		});
	}

	// Function to enable the final deny activity button.
	function medwestHealthpointsFinalEnableDenyActivity(){

		$( document ).on( 'change', '.medwest-deny-activity-actual-reason', function( event ) {

			var value = $(this).val();

			if( null !== value && '' !== value && undefined !== value ) {
				$(this).next().removeAttr( 'disabled' )
			}
		});


	}

	// Function to expand the deny pending Activities section.
	function medwestHealthpointsExpandDenyActivity(){

		$( document ).on( 'click', '.medwest-activity-deny-button', function( event ) {

			var element = $(this).parent().parent().parent().next();
			console.log(element);

			var autoHeight = 0;

			// Get Default Height
			var curHeight = element.height();

			// Get Auto Height
			autoHeight = element.css( 'height', 'auto' ).height();

			// Reset to Default Height
			element.height( curHeight );

			// Animate to Auto Height
			element.stop().animate({
				height: autoHeight,
				opacity: 1,
			}, {
				duration: 1000,
				complete: function() {
					userDiv.css({'height': 'auto'});
					controllerDiv.attr('data-state', 'open')
					
				}
			});

		});


	}

	// Function to deny pending Activities.
	function medwestHealthpointsDenyActivity(){

		$( document ).on( 'click', '.medwest-activity-deny-button-actual', function( event ) {
			var useridnumber = $( this ).attr( 'data-useremployeeid' );
			var activityid = $( this ).attr( 'data-activityid' );
			var userhealthpoints = $( this ).attr( 'data-userhealthpoints' );
			var useremail = $( this ).attr( 'data-useremail' );
			var userwpuserid = $( this ).attr( 'data-wpuserid' );
			var activityname = $( this ).attr( 'data-activityname' );



			var denialreason = $( this ).prev().val()
			$(this).parent().next().css( 'opacity', 1 );

			var data = {
				'action': 'medwesthealthpoints_deny_activities_user_action',
				'security': medwestHealthpointsPhpVariables.adminnonce5,
				'useridnumber':useridnumber,
				'activityid':activityid,
				'userhealthpoints':userhealthpoints,
				'useremail':useremail,
				'denialreason':denialreason,
				'userwpuserid':userwpuserid,
				'activityname':activityname,
	        };

        	console.log('This is the data being sent to the server to create a new user');
        	console.log(data);

			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					document.location.reload(true);					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});

		});
	}

	// Function to approve pending Rewards.
	function medwestHealthpointsApproveReward(){

		$( document ).on( 'click', '.medwest-reward-approve-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var rewardrequestid = $( this ).attr( 'data-rewardrequestid' );
			var useremail = $( this ).attr( 'data-useremail' );

			var data = {
	          'action': 'medwesthealthpoints_approve_rewards_user_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce12,
	          'rewardrequestid':rewardrequestid,
	          'useremail': useremail,
	        };

        	console.log('This is the data being sent to the server to approve a rewards request');
        	console.log(data);


			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true);
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});

		});
	}

	// Function to deny pending Rewards.
	function medwestHealthpointsDenyReward(){

		$( document ).on( 'click', '.medwest-reward-deny-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})
			
			var useridnumber = $( this ).attr( 'data-useremployeeid' );
			var userhealthpoints = $( this ).attr( 'data-userhealthpoints' );
			var rewardrequestid = $( this ).attr( 'data-rewardrequestid' );


			var data = {
	          'action': 'medwesthealthpoints_deny_rewards_user_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce13,
	          'useridnumber':useridnumber,
	          'userhealthpoints':userhealthpoints,
	          'rewardrequestid':rewardrequestid,
	        };

        	console.log('This is the data being sent to the server to deny a rewards request.');
        	console.log(data);


			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true);
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});

		});
	}













	// Function for enabling the 'Upload Files' buttons.
	function medWestWordPressFileUpload() {

		// For the book cover image upload.
		var fileFrame;
		var wpMediaPostId = 0;
		var setToPostId = 0;

		// Must be parsed to an int! All the medwestHealthpointsPhpVariables are strings initially.
		setToPostId = 0;

		$( document ).on( 'click', '.medwest-form-section-fields-input-file-upload-button', function( event ) {

			var thisbutton = $( this );
			event.preventDefault();

			// Create the media frame.
			fileFrame = wp.media.frames.fileFrame = wp.media({
				title: 'Upload Supporting Documentation For Your Activity',
				button: {
					text: 'Select This File',
				},
				multiple: false
			});

			// When an image is selected, run a callback.
			fileFrame.on( 'select', function() {

				// We set multiple to false so only get one image from the uploader
				var attachment = fileFrame.state().get( 'selection' ).first().toJSON();

				// Do something with attachment.id and/or attachment.url here
				thisbutton.prev().val( attachment.url );
				thisbutton.prev().prev().attr( 'src', attachment.url );
			});

			// Finally, open the modal
			fileFrame.open();
		});
	}

	// This is a function to let the admin create a new reward.
	function medWestCreateNewReward(){

		$( document ).on( 'click', '#medwest-create-reward-backend-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var rewardname = $( '#medwest-input-rewardname' ).val();
			var rewardpointvalue = $( '#medwest-input-rewardpointvalue' ).val();
			var rewardimage = $( '#medwest-input-rewardimage' ).val();
			var rewardurl = $( '#medwest-input-rewardurl' ).val();
			var rewarddescription = $( '#medwest-input-rewarddescription' ).val();
			var proceed = true;
			if ( '' === rewardname ) {
				$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
				alert( 'Whoops! Looks like you forgot to name the reward!' );
				proceed = false;
				return false;
			}

			if ( '' === rewardpointvalue ) {
				$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
				alert( 'Whoops! Looks like you forgot provide the number of points this Reward is worth!' );
				proceed = false;
				return false;
			}

			if ( '' === rewarddescription ) {
				$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
				alert( 'Whoops! Looks like you forgot to provide a Reward Description!' );
				proceed = false;
				return false;
			}

			if ( proceed ) {
				var data = {
		          'action': 'medwesthealthpoints_create_new_reward_action',
		          'security': medwestHealthpointsPhpVariables.adminnonce6,
		          'rewardname':rewardname,
		          'rewardpointvalue':rewardpointvalue,
		          'rewardimage':rewardimage,
		          'rewardurl':rewardurl,
		          'rewarddescription':rewarddescription,
		        };

	        	console.log('This is the data being sent to the server to create a new user');
	        	console.log(data);


				var request = $.ajax({
					url: ajaxurl,
					type: "POST",
					data:data,
					timeout: 0,
					success: function(response) {
						console.log(response);
						document.location.reload(true);
						
					},
					error: function(jqXHR, textStatus, errorThrown) {
						console.log(errorThrown);
						console.log(textStatus);
						console.log(jqXHR);
					}
				});
			}
		});
	}



	// This is a function to let the admin edit a reward.
	function medWestEditReward(){

		$( document ).on( 'click', '.medwest-edit-reward-backend-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var id = $( this ).attr( 'data-rewardid' );
			var rewardname = $( this).parent().parent().find( '#medwest-input-rewardname' ).val();
			var rewardpointvalue = $( this).parent().parent().find( '#medwest-input-rewardpointvalue' ).val();
			var rewardimage = $( this).parent().parent().find( '#medwest-input-rewardimage' ).val();
			var rewardurl = $( this).parent().parent().find( '#medwest-input-rewardurl' ).val();
			var rewarddescription = $( this).parent().parent().find( '#medwest-input-rewarddescription' ).val();

			var data = {
	          'action': 'medwesthealthpoints_edit_reward_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce7,
	          'rewardname':rewardname,
	          'rewardpointvalue':rewardpointvalue,
	          'rewardimage':rewardimage,
	          'rewardurl':rewardurl,
	          'rewarddescription':rewarddescription,
	          'id':id,
	        };

	        console.log(data)

			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true)
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});
		});
	}

	// This is a function to let the admin delete a reward.
	function medWestDeleteReward(){

		$( document ).on( 'click', '.medwest-delete-reward-backend-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var id = $( this ).attr( 'data-rewardid' );

			var data = {
	          'action': 'medwesthealthpoints_delete_reward_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce8,
	          'id':id,
	        };

	        console.log(data)

			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true)
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});
		});
	}

	// This is a function to let the admin create a new Activity.
	function medWestCreateNewActivity(){

		$( document ).on( 'click', '#medwest-create-activity-backend-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var activityname = $( '#medwest-input-activityname' ).val();
			var activitycategory = $( '#medwest-input-activitycategory' ).val();
			var activitypointsvalue = $( '#medwest-input-activitypointsvalue' ).val();
			var activitysupportingdocsrequired = $( '#medwest-input-supportingdocsrequired' ).val();
			var proceed = true;
			var userIterator = 0;
			var totalAdded = 0;
			var errorCounter = 0;
	  		var failedIsbns = '';

			if ( '' === activitypointsvalue ) {
				$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
				alert( 'Whoops! Looks like you forgot provide the number of points this Activity is worth!' );
				proceed = false;
				return false;
			}

			if ( null === activitycategory ) {
				$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
				alert( 'Whoops! Looks like you forgot provide the Category for this Activity!' );
				proceed = false;
				return false;
			}

			if ( '' === activityname ) {
				$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
				alert( 'Whoops! Looks like you forgot to name the Activity!' );
				proceed = false;
				return false;
			}


			

			if ( proceed ) {
				var data = {
		          'action': 'medwesthealthpoints_create_new_activity_action',
		          'security': medwestHealthpointsPhpVariables.adminnonce9,
		          'activityname':activityname,
		          'activitycategory':activitycategory,
		          'activitypointsvalue':activitypointsvalue,
		          'activitysupportingdocsrequired':activitysupportingdocsrequired,
		        };

		        var checkedUsersEmployeeId = [];
		        var checkedUsersWpId = [];
		        var checkedUsersHealthPoints = [];
		        var d = new Date();
		        var activitydateperformed = d.getFullYear() + '-' + d.getMonth() + '-' + d.getDate();

		        $('.medwest-addusertoactivity-checkbox-actual').each(function(index){
					var checked  = $( this ).prop( "checked" );

					if ( true === checked && '' !== $( this ).val() && ' ' !== $( this ).val() ){
						checkedUsersEmployeeId.push( $( this ).val() );
						checkedUsersWpId.push( $( this ).attr( 'data-wpuserid' ) );
						checkedUsersHealthPoints.push( $( this ).attr( 'data-userhealthpoints' ) );
					} 

					
				});

	        	console.log('This is the data being sent to the server to create a new user');
	        	console.log(data);



				var request = $.ajax({
					url: ajaxurl,
					type: "POST",
					data:data,
					timeout: 0,
					success: function(response) {
						console.log(response);

						if ( 0 < checkedUsersEmployeeId.length ) {

							// Calculate minutes.
							var waittime = 0;
							if ( 20 > checkedUsersEmployeeId.length ) {
								waittime = 'less than one minute';
							} else {
								waittime = Math.trunc( ( ( checkedUsersEmployeeId.length / 60 ) * 3 ) ) + ' minutes';
							}

							// Set up UI stuff for reporting how many activities will be added to how many users...
							$( '#medwest-bulk-add-activity-to-users-estimate-wrapper' ).html( 'Adding Activity to ' + checkedUsersEmployeeId.length + ' Users. This\'ll take about ' + waittime + '  <img style="width: 15px; position: relative; top: 2px;" class="medwest-admin-message-smiley-face" src="' + medwestHealthpointsPhpVariables.MEDWESTHEALTHPOINTS_ROOT_IMG_ICONS_URL + 'happy.svg"/>' );

							// One Ajax call per ISBN number
			  				(function medWestBulkUsersToNewActivity() {

								var data = {
						          'action': 'medwesthealthpoints_save_activity_user_action',
						          'security': medwestHealthpointsPhpVariables.adminnonce2,
						          'activityname':activityname,
						          'activitycategory':activitycategory,
						          'activitydateperformed':activitydateperformed,
						          'activitysupportingdocs':'Admin Assigned - No Supporting Docs',
						          'activitywpuserid': checkedUsersWpId[userIterator],
						          'activityemployeeid': checkedUsersEmployeeId[userIterator],
						          'activitystatus': 'Approved',
						        };

						  

					        	console.log('This is the data being sent to the server to save a user\'s activity' );
					        	console.log(data);

								var request = $.ajax({
									url: ajaxurl,
									type: "POST",
									data:data,
									timeout: 0,
									success: function(response) {

										if( response == '' || response == 'undefined' || response == undefined || response == 0 ){
								    		failedIsbns = failedIsbns+','+response[1];
								    		errorCounter++;
								    	} else {
								    		totalAdded++;

								    		$( '#medwest-bulk-add-activity-to-users-progress-wrapper' ).text( 'Added Activity to ' + totalAdded + ' Users successfully so far! Do NOT close this page until complete! ' );

								    		// Since we added the Activity to the user correctly, we now need to give them HealthPoints
								    		var data = {
									          'action': 'medwesthealthpoints_approve_activities_user_action',
									          'security': medwestHealthpointsPhpVariables.adminnonce4,
									          'useridnumber':checkedUsersEmployeeId[userIterator],
									          'userhealthpoints': parseInt( checkedUsersHealthPoints[userIterator] ) + parseInt( activitypointsvalue ),
									        };

								        	console.log('This is the data being sent to the server to create a new user');
								        	console.log(data);


											var request = $.ajax({
												url: ajaxurl,
												type: "POST",
												data:data,
												timeout: 0,
												success: function(response) {
													console.log(response);
													//document.location.reload(true);
													
												},
												error: function(jqXHR, textStatus, errorThrown) {
													console.log(errorThrown);
													console.log(textStatus);
													console.log(jqXHR);
												}
											});

								    	}

										console.log(response);

										
									},
									error: function(jqXHR, textStatus, errorThrown) {
										console.log(errorThrown);
										console.log(textStatus);
										console.log(jqXHR);
									},
									complete: function() {
										userIterator++;
								      	// Schedule the next request when the current one's complete, if we're not doen already
								      	if ( totalAdded != (checkedUsersEmployeeId.length - errorCounter ) ) {
											setTimeout( medWestBulkUsersToNewActivity, 1000 );
										} else {
											$('#medwesthealthpoints-spinner-1').animate({'opacity':'0'})
											$( '#medwest-bulk-add-activity-to-users-progress-wrapper' ).text( 'Added Activity to ' + totalAdded + ' Users! You may now leave this page. ' );
										}
								    }
								});
							})();
						} else {
							// We're not adding this new Activity to any Users, so reload page once Activity is created.
							document.location.reload(true);
						}
					},
					error: function(jqXHR, textStatus, errorThrown) {
						console.log(errorThrown);
						console.log(textStatus);
						console.log(jqXHR);
					}
				});

				
			}
		});
	}

	// This is a function to let the admin edit an activity.
	function medWestEditActivity(){

		$( document ).on( 'click', '.medwest-edit-activity-backend-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var id = $( this ).attr( 'data-id' );
			var activityname = $( this).parent().parent().find( '#medwest-input-activityname' ).val();
			var activitypointsvalue = $( this).parent().parent().find( '#medwest-input-activitypointsvalue' ).val();
			var activitycategory = $( this).parent().parent().find( '#medwest-input-activitycategory' ).val();
			var requireddocs = $( this).parent().parent().find( '#medwest-input-supportingdocsrequired' ).val();

			var data = {
	          'action': 'medwesthealthpoints_edit_activity_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce10,
	          'activityname':activityname,
	          'activitypointsvalue':activitypointsvalue,
	          'activitycategory':activitycategory,
	          'activitysupportingdocsrequired':requireddocs,
	          'id':id,
	        };

	        console.log(data)

			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true);
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});
		});
	}

	// This is a function to allow the admin to Delete activities. 
	function medWestDeleteActivity(){

		$( document ).on( 'click', '.medwest-delete-activity-backend-button', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var id = $( this ).attr( 'data-id' );

			var data = {
	          'action': 'medwesthealthpoints_delete_activity_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce11,
	          'id':id,
	        };

	        console.log(data)

			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					document.location.reload(true);
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});
		});
	}


	// This is a function to allow the admin to bulk-upload users.
	function medWestBulkUploadUsers(){

		$( document ).on( 'click', '#medwesthealthpoints-bulk-upload-users', function( event ) {

			$('#medwesthealthpoints-spinner-1').animate({'opacity':'1'})

			var id = $( this ).attr( 'data-id' );

			var data = {
	          'action': 'medwesthealthpoints_bulk_upload_users_action',
	          'security': medwestHealthpointsPhpVariables.adminnonce14,
	          'id':id,
	        };

	        console.log(data)

			var request = $.ajax({
				url: ajaxurl,
				type: "POST",
				data:data,
				timeout: 0,
				success: function(response) {
					console.log(response);
					//document.location.reload(true);
					
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					console.log(textStatus);
					console.log(jqXHR);
				}
			});
		});
	}


});
